#
# Set up environment variables for general build tool to operate
#
export ZOPEN_TYPE="TARBALL"
export ZOPEN_TARBALL_URL="https://github.com/facebook/zstd/archive/refs/tags/v1.5.2.tar.gz"
export ZOPEN_TARBALL_DEPS="curl gzip make coreutils diffutils findutils"
export ZOPEN_BOOTSTRAP=skip
export ZOPEN_CONFIGURE=skip
export ZSTD_NO_ASM=1

#export ZOPEN_INSTALL_OPTS="install POSIX_ENV=Yes prefix=\${ZOPEN_INSTALL_DIR}" 
export ZOPEN_INSTALL_OPTS="install prefix=\${ZOPEN_INSTALL_DIR}" 

#
# Starter for Python
# (probably not commonmark but keep it here so I remember syntax to pull in package)
#
if ! type python3 >/dev/null || ! ( pip3 freeze | grep -q commonmark ); then
  echo "need python3 with commonmark package set up for build of zstd" >&2
  return 4
fi
export PATH=${HOME}/.local/bin:$PATH

export ZOPEN_NAME="zstd-1.5.2"
rm -f v1.5.2
ln -s ${ZOPEN_NAME} v1.5.2

zopen_append_to_env()
{
cat <<ZZ
if [ ! -z "\$ZOPEN_IN_ZOPEN_BUILD" ]; then
  export ZOPEN_EXTRA_CFLAGS="\${ZOPEN_EXTRA_CFLAGS} -I\$PWD/include"
  export ZOPEN_EXTRA_CXXFLAGS="\${ZOPEN_EXTRA_CXXFLAGS} -I\$PWD/include"
  export ZOPEN_EXTRA_LDFLAGS="\${ZOPEN_EXTRA_LDFLAGS} -L\$PWD/lib"
  export ZOPEN_EXTRA_LIBS="\${ZOPEN_EXTRA_LIBS} -lzstd"
fi
ZZ
}

zopen_check_results()
{
  return 3 # non-functional
}

